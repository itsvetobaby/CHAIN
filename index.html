<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="skeleton.css">
    <link rel="stylesheet" href="helper.css">
</head>
<body>
  <script src="editor.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/promise.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/radix.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/radisk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/store.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/lib/rindexed.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.0.11/dist/purify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  


    <div class="container" >
        <div class="info boxed" style="margin-top:0em; font-family: arialBlack; margin-top: 1em; ">
               
            <a href="index.html">
                <svg class="svg-icon" viewBox="0 0 20 20">
                    <path fill="none" d="M8.388,10.049l4.76-4.873c0.303-0.31,0.297-0.804-0.012-1.105c-0.309-0.304-0.803-0.293-1.105,0.012L6.726,9.516c-0.303,0.31-0.296,0.805,0.012,1.105l5.433,5.307c0.152,0.148,0.35,0.223,0.547,0.223c0.203,0,0.406-0.08,0.559-0.236c0.303-0.309,0.295-0.803-0.012-1.104L8.388,10.049z"></path>
                </svg>
            </a>

        
            <div  onclick="toggle(this)" id="bt" style="float: right;" >
                
                <svg class="svg-icon" viewBox="0 0 20 20">
                    <path d="M14.68,12.621c-0.9,0-1.702,0.43-2.216,1.09l-4.549-2.637c0.284-0.691,0.284-1.457,0-2.146l4.549-2.638c0.514,0.661,1.315,1.09,2.216,1.09c1.549,0,2.809-1.26,2.809-2.808c0-1.548-1.26-2.809-2.809-2.809c-1.548,0-2.808,1.26-2.808,2.809c0,0.38,0.076,0.741,0.214,1.073l-4.55,2.638c-0.515-0.661-1.316-1.09-2.217-1.09c-1.548,0-2.808,1.26-2.808,2.809s1.26,2.808,2.808,2.808c0.9,0,1.702-0.43,2.217-1.09l4.55,2.637c-0.138,0.332-0.214,0.693-0.214,1.074c0,1.549,1.26,2.809,2.808,2.809c1.549,0,2.809-1.26,2.809-2.809S16.229,12.621,14.68,12.621M14.68,2.512c1.136,0,2.06,0.923,2.06,2.06S15.815,6.63,14.68,6.63s-2.059-0.923-2.059-2.059S13.544,2.512,14.68,2.512M5.319,12.061c-1.136,0-2.06-0.924-2.06-2.06s0.923-2.059,2.06-2.059c1.135,0,2.06,0.923,2.06,2.059S6.454,12.061,5.319,12.061M14.68,17.488c-1.136,0-2.059-0.922-2.059-2.059s0.923-2.061,2.059-2.061s2.06,0.924,2.06,2.061S15.815,17.488,14.68,17.488"></path>
                </svg>
                   
            </div>
        
            <!--The DIV element to toggle visibility. Its "display" property is set as "none". -->
            
                <div style="
                    padding:10px; 
                    display:none;" 
                    id="cont">
            
                <div style="float: right;">
                    <svg class="svg-icon" viewBox="0 0 20 20">
                        <path fill="none" d="M18.258,3.266c-0.693,0.405-1.46,0.698-2.277,0.857c-0.653-0.686-1.586-1.115-2.618-1.115c-1.98,0-3.586,1.581-3.586,3.53c0,0.276,0.031,0.545,0.092,0.805C6.888,7.195,4.245,5.79,2.476,3.654C2.167,4.176,1.99,4.781,1.99,5.429c0,1.224,0.633,2.305,1.596,2.938C2.999,8.349,2.445,8.19,1.961,7.925C1.96,7.94,1.96,7.954,1.96,7.97c0,1.71,1.237,3.138,2.877,3.462c-0.301,0.08-0.617,0.123-0.945,0.123c-0.23,0-0.456-0.021-0.674-0.062c0.456,1.402,1.781,2.422,3.35,2.451c-1.228,0.947-2.773,1.512-4.454,1.512c-0.291,0-0.575-0.016-0.855-0.049c1.588,1,3.473,1.586,5.498,1.586c6.598,0,10.205-5.379,10.205-10.045c0-0.153-0.003-0.305-0.01-0.456c0.7-0.499,1.308-1.12,1.789-1.827c-0.644,0.28-1.334,0.469-2.06,0.555C17.422,4.782,17.99,4.091,18.258,3.266"></path>
                    </svg>
                </div>
                <svg class="svg-icon" viewBox="0 0 20 20" style="float: right; padding-right:1em;">
                    <path d="M16.469,8.924l-2.414,2.413c-0.156,0.156-0.408,0.156-0.564,0c-0.156-0.155-0.156-0.408,0-0.563l2.414-2.414c1.175-1.175,1.175-3.087,0-4.262c-0.57-0.569-1.326-0.883-2.132-0.883s-1.562,0.313-2.132,0.883L9.227,6.511c-1.175,1.175-1.175,3.087,0,4.263c0.288,0.288,0.624,0.511,0.997,0.662c0.204,0.083,0.303,0.315,0.22,0.52c-0.171,0.422-0.643,0.17-0.52,0.22c-0.473-0.191-0.898-0.474-1.262-0.838c-1.487-1.485-1.487-3.904,0-5.391l2.414-2.413c0.72-0.72,1.678-1.117,2.696-1.117s1.976,0.396,2.696,1.117C17.955,5.02,17.955,7.438,16.469,8.924 M10.076,7.825c-0.205-0.083-0.437,0.016-0.52,0.22c-0.083,0.205,0.016,0.437,0.22,0.52c0.374,0.151,0.709,0.374,0.997,0.662c1.176,1.176,1.176,3.088,0,4.263l-2.414,2.413c-0.569,0.569-1.326,0.883-2.131,0.883s-1.562-0.313-2.132-0.883c-1.175-1.175-1.175-3.087,0-4.262L6.51,9.227c0.156-0.155,0.156-0.408,0-0.564c-0.156-0.156-0.408-0.156-0.564,0l-2.414,2.414c-1.487,1.485-1.487,3.904,0,5.391c0.72,0.72,1.678,1.116,2.696,1.116s1.976-0.396,2.696-1.116l2.414-2.413c1.487-1.486,1.487-3.905,0-5.392C10.974,8.298,10.55,8.017,10.076,7.825"></path>
                </svg>
            
                </div>
            </body>
            <script>
                function toggle(ele) {
                    var cont = document.getElementById('cont');
                    cont.style.display = cont.style.display == 'none' ? 'block' : 'none';
                }
            </script>
        </div>

  
        <div class="boxed" style="padding: 1em; margin-top: 1em;">
            <br><br>
            <h3 id="savedText" class="lang" key="saved" > </h3>

            <h4 id="content"></h4>

            <h1 id="price"></h1>

            <h2 id="author"></h2>

            <h5 id="title"></h5>
            <h5 id="wallet"></h5>
        </div>

        <div id="meta" style="display:none; text-transform: uppercase;"> 
            
            <p id="time" style="font-family: Arial, Helvetica, sans-serif;"> <span id="lastUpdated"></span></p>
            <div id="verificationSection" style="display:none;">
                <label> </label><input onchange="save(this)" id="verification" placeholder="VERIFY"></input>
            </div>
        </div>
                 
        
        
        
        <script>
                const peers = ['https://gun-us.herokuapp.com/gun','https://gun-eu.herokuapp.com/gun', 'https://gunjs.herokuapp.com/gun'];
                const gun = Gun({localStorage:false, peers:peers});
                const user = gun.user();
                const SEA = Gun.SEA;
                var myKeys = {};
                var urlPassword = '';
                var currentTitle = '';
                var hash = '';
                const savedTextEl = document.getElementById('savedText');

                async function publish() {
                    localStorage.setItem(myKeys.pub, JSON.stringify(myKeys));
                    await gun.get(`APAC#`).get(hash).promPut(myKeys.pub); 
                    var url = `?t=${encodeURIComponent(currentTitle.replace(/\s+/g, '-').toLowerCase())}&p=${urlPassword}#${hash}`
                    history.pushState({},'', url);
                    location.reload();
                }

                function copyLink(buttonElement) {
                navigator.clipboard.writeText(location.href).then(function() {
                    buttonElement.innerText = 'Copied';
                }, function() {
                    buttonElement.innerText = 'Copy permissions denied';
                });
                }

                function deleteArticle(buttonElement) {
                    user.get('articles').get(hash).map().once(async (node, nodeID) => {
                        user.get('articles').get(hash).get(nodeID).promPut(null);
                    })
                    localStorage.removeItem(myKeys.pub);
                    buttonElement.innerText = 'Deleted';
                }

                function debounce(func, delay) {
                    let inDebounce
                    return function() {
                        const context = this
                        const args = arguments
                        clearTimeout(inDebounce)
                        inDebounce = setTimeout(() => func.apply(context, args), delay)
                    }
                }

                async function save(event, editable) {
                    savedTextEl.classList.remove('fadeInAndOut');
                    void savedTextEl.offsetWidth;
                    
                    var content = '';
                    var name = '';
                    if (event.id){
                        name = event.id
                        content = event.value
                    } else if (event.target) {
                        name = event.target.id
                        content = editable.innerHTML;
                    }
                    if (name === 'title') { currentTitle = editable.innerText }
                    var encNode = await SEA.encrypt(content, urlPassword)
                    await user.get('articles').get(hash).get(name).promPut(encNode)
                    var encTime = await SEA.encrypt(new Date().toUTCString(), urlPassword)
                    await user.get('articles').get(hash).get('lastUpdated').promPut(encTime);

                    savedTextEl.classList.add('fadeInAndOut');
                }

                function renderArticle(authorPub, articleHash, audienceType) {
                    if (audienceType == 'create') {
                        var editorTitle = new MediumEditor('#title', {placeholder: {
                            text: 'Clique',
                            hideOnClick: false
                        }, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorAuthor = new MediumEditor('#author', {placeholder: {
                            text: 'Name',
                            hideOnClick: false
                        }, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorWallet = new MediumEditor('#wallet', {placeholder: {
                            text: 'Wallet Address',
                            hideOnClick: false
                        }, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorPrice = new MediumEditor('#price', {placeholder: {
                            text: 'Price',
                            hideOnClick: false
                        }, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorContent = new MediumEditor('#content', {
                            placeholder: {
                                text: 'Product',
                                hideOnClick: false
                            }, 
                            spellcheck: true,
                            autoLink: true,
                            toolbar: { 
                                buttons: ['bold', 'italic', 'underline', 'anchor', 'h2', 'h3', 'quote', 'pre', 'unorderedlist','orderedlist'] 
                            }
                        });
                        editorTitle.subscribe('editableInput', debounce(save, 1000));
                        editorAuthor.subscribe('editableInput', debounce(save, 1000));
                        editorWallet.subscribe('editableInput', debounce(save, 1000));
                        editorPrice.subscribe('editableInput', debounce(save, 1000));
                        editorContent.subscribe('editableInput', debounce(save, 1000));

                        document.getElementById('publishButton').style.cssText = "";
                        document.getElementById('about').style.cssText = "";
                    } 
                    else if (audienceType == 'read') {
                        gun.get(`~${authorPub}`).get('articles').get(articleHash).map().once(async (node, nodeID) => {
                            if (nodeID !== 'pass') {
                                var decNode = await SEA.decrypt(node, urlPassword);
                                if (nodeID == 'verification') {
                                    document.getElementById('verification').outerHTML = `<a href="${DOMPurify.sanitize(decNode)}">${DOMPurify.sanitize(decNode)}</a>`;
                                    document.getElementById('verificationSection').style.display = "";
                                } else {
                                    document.getElementById(nodeID).innerHTML = DOMPurify.sanitize(decNode);
                                }
                            }
                        })
                        document.getElementById('meta').style.display = "";
                        document.getElementById('copyButton').style.display = "";
                    } 
                    else if (audienceType == 'update') {
                        gun.get(`~${authorPub}`).get('articles').get(articleHash).map().once(async (node, nodeID) => {
                            if (nodeID !== 'pass') {
                                var decNode = await SEA.decrypt(node, urlPassword);
                                if (nodeID == 'verification') {
                                    document.getElementById(nodeID).value = DOMPurify.sanitize(decNode);
                                } else {
                                    document.getElementById(nodeID).innerHTML = DOMPurify.sanitize(decNode);
                                }
                            }
                        })
                        
                        var editorTitle = new MediumEditor('#title', {placeholder: false, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorAuthor = new MediumEditor('#author', {placeholder: false, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorWallet = new MediumEditor('#wallet', {placeholder: false, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorPrice = new MediumEditor('#price', {placeholder: false, spellcheck: false, disableReturn: true,toolbar: false});
                        var editorContent = new MediumEditor('#content', {
                            placeholder: false, 
                            spellcheck: true, 
                            autoLink: true,
                            toolbar: { 
                                buttons: ['bold', 'italic', 'underline', 'anchor', 'h2', 'h3', 'quote', 'pre', 'unorderedlist','orderedlist'] 
                            }
                        });
                        editorTitle.subscribe('editableInput', debounce(save, 1000));
                        editorAuthor.subscribe('editableInput', debounce(save, 1000));
                        editorWallet.subscribe('editableInput', debounce(save, 1000));
                        editorPrice.subscribe('editableInput', debounce(save, 1000));
                        editorContent.subscribe('editableInput', debounce(save, 1000));

                        document.getElementById('meta').style.display = "";
                        document.getElementById('copyButton').style.display = "";
                        document.getElementById('verificationSection').style.display = "";
                        document.getElementById('deleteButton').style.display = "";
                    }
                    document.getElementById('app').style.cssText = "";
                }
                
                async function go() {
                    if (window.location.search) {
                        urlPassword = new URLSearchParams(window.location.search).get("p");
                        hash = window.location.hash.slice(1)
                        var authorPubKey = await gun.get('APAC#').get(hash).promOnce();
                        authorPubKey = authorPubKey.data
                        var localstorageKeyPair = localStorage.getItem(authorPubKey);
                        if (localstorageKeyPair) {
                            myKeys = JSON.parse(localstorageKeyPair);
                            user.auth(myKeys);
                            if (user.is) {
                                renderArticle(authorPubKey, hash, 'update');
                            }
                        } else {
                            renderArticle(authorPubKey, hash, 'read');
                        }
                    } else {
                        myKeys = await SEA.pair();
                        urlPassword = SEA.random(11).toString('hex');
                        user.auth(myKeys);
                        hash = await SEA.work(myKeys.pub, null, null, {name: "SHA-256"});
                        var encPass = await SEA.encrypt(urlPassword, myKeys);
                        await user.get('articles').get(hash).get('pass').promPut(encPass);
                        renderArticle(myKeys.pub, hash, 'create');
                    }
                }
                go();
        </script>

                    
                    <script type="text/javascript">
                        window.addEventListener('load', async () => {
                        if (window.ethereum) {
                            window.web3 = new Web3(ethereum);
                            try {
                            await ethereum.enable();
                            initPayButton()
                            } catch (err) {
                            $('#status').html('User denied account access', err)
                            }
                        } else if (window.web3) {
                            window.web3 = new Web3(web3.currentProvider)
                            initPayButton()
                        } else {
                            $('#status').html('No Metamask (or other Web3 Provider) installed')
                        }
                        })
                    
                        const initPayButton = () => {
                        $('#pay-button').click(() => {
                            // paymentAddress is where funds will be send to
                            // code beneath not safe - dont push to production
                            const paymentAddress = document.getElementById("wallet").innerHTML
                            // code beneath not safe - dont push to production
                            const amountEth = document.getElementById("price").innerHTML
        
                    
                    
                            web3.eth.sendTransaction({
                            to: paymentAddress,
                            value: web3.toWei(amountEth, 'ether')
                            }, (err, transactionId) => {
                            if  (err) {
                                console.log('Payment failed', err)
                                $('#status').html('Payment failed')
                            } else {
                                console.log('Payment successful', transactionId)
                                $('#status').html('Payment successful')
                            }
                            })
                        })
                        }
                    </script>
        
        

        
       
        
        <div style="width:50%; display:inline-block;" class=""><button id="pay-button"><h3>PAY</h3></button></div>
        <br>
        </div>

        <br>

    </div>


    <div class="tcontainer"><div class="ticker-wrap"><div class="ticker-move">
        <div class="ticker-item">//////////INCARTI//</div>
        <div class="ticker-item">//////////INCARTI//</div>
        <div class="ticker-item">//////////INCARTI//</div>
        <div class="ticker-item">//INCARTI////////INCARTI//</div>
    </div>
    </div>






</body>
</html>